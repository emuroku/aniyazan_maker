(()=>{"use strict";var t,e,a,o,n=240,l=300,r=420,i=150,d=160,c=100,f=new Image;f.src="resource/img/aniyazan_maker_template.png";var u=document.querySelector("#cv"),s=u.getContext("2d");function m(e){t.innerHTML=e}function g(){var t=e.value,o=a.valueAsNumber;try{p.add({name:t,wins:o}),p.save(),p.load(),m(p.getHtml())}catch(t){document.getElementById("error_msg").textContent=t.message}}function h(){p.data=[],p.save(),p.load(),e.value="",a.value="",o.value="名無しさん",m(p.getHtml()),s.clearRect,s.drawImage(f,0,0)}function y(){p.createImg()}function v(){u.style.border="2px solid #222222";var t=document.createElement("a");t.href=u.toDataURL("image/png"),t.download="image.png",t.click()}f.onload=function(){s.drawImage(f,0,0),p.createImg()};var p=new(function(){function t(){this.data=[]}return t.prototype.add=function(t){if(!(this.data.length<9))throw new Error("登録できるのは9人までです");this.data.push(t)},t.prototype.save=function(){localStorage.setItem("player_data",JSON.stringify(this.data))},t.prototype.load=function(){var t=JSON.parse(localStorage.getItem("player_data"));this.data=t||[]},t.prototype.getHtml=function(){for(var t="<thead><th>投手名</th><th>勝利数</th></thead><tbody>",e=0,a=this.data;e<a.length;e++){var o=a[e];t+="<tr><td>"+o.name+"</td><td>"+o.wins.toLocaleString()+"</td></tr>"}return t+"</tbody><tr><td>合計</td><td>"+this.getTotal()+"</td></tr>"},t.prototype.getTotal=function(){for(var t=0,e=0,a=this.data;e<a.length;e++)t+=a[e].wins;return t.toLocaleString()},t.prototype.createImg=function(){s.drawImage(f,0,0);for(var t=0;t<this.data.length;t++)e=this.data[t].name,a=this.data[t].wins.toLocaleString(),u=t,void 0,m=o.value,s.font="bold 65px 'M PLUS 1'",s.textAlign="center",s.fillStyle="#666666",s.textBaseline="bottom",s.strokeText(e,n+u%3*r,l+Math.floor(u/3)*i,d),s.fillText(e,n+u%3*r,l+Math.floor(u/3)*i,d),s.font="bold 80px 'M PLUS 1', sans-serif, #ff0000",s.fillStyle="#ff0000",s.strokeText(a,400+u%3*r,l+Math.floor(u/3)*i,c),s.fillText(a,400+u%3*r,l+Math.floor(u/3)*i,c),s.font="bold 50px 'M PLUS 1'",s.fillStyle="#666666",s.fillText("勝",500+u%3*r,l+Math.floor(u/3)*i,100),s.font="bold 40px 'M PLUS 1'",s.fillStyle="#000000",s.fillText(m,1030,95,300),s.fillText("の安仁屋算が公開",1375,95,800),s.beginPath(),s.moveTo(n+u%3*r-70,l+(Math.floor(u/3)*i+10)),s.lineTo(n+u%3*r+d+c+20,l+(Math.floor(u/3)*i+10)),s.stroke();var e,a,u,m,g;g=this.getTotal(),s.font="bold 160px 'M PLUS 1'",s.textAlign="center",s.fillStyle="#ff0000",s.fillText(g,900,830,300),s.fillText(g,900,830,300)},t}());window.addEventListener("load",(function(){t=document.querySelector("#table"),e=document.querySelector("#player"),a=document.querySelector("#wins"),o=document.querySelector("#username"),document.querySelector("#btn").addEventListener("click",g),document.querySelector("#initial").addEventListener("click",h),document.querySelector("#create").addEventListener("click",y),document.getElementById("btn_dl").addEventListener("click",v),p.load(),m(p.getHtml())}))})();