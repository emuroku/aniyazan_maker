(()=>{"use strict";var t,e,o,a,n=240,r=300,l=420,i=150,d=160,c=100,f=document.getElementById("error_msg"),s=new Image;s.src="resource/img/aniyazan_maker_template.png";var u=document.querySelector("#cv"),m=u.getContext("2d");function g(e){t.innerHTML=e}function h(){var t=e.value,a=o.valueAsNumber;try{S.checkinput({name:t,wins:a}),S.add({name:t,wins:a}),S.save(),S.load(),g(S.getHtml())}catch(t){f.textContent=t.message}}function p(){S.data=[],S.save(),S.load(),e.value="",o.value="",a.value="名無しさん",f.textContent="",g(S.getHtml()),m.clearRect,m.drawImage(s,0,0)}function y(){S.createImg()}function v(){u.style.border="2px solid #222222";var t=document.createElement("a");t.href=u.toDataURL("image/png"),t.download="image.png",t.click()}s.onload=function(){m.drawImage(s,0,0),S.createImg()};var S=new(function(){function t(){this.data=[]}return t.prototype.checkinput=function(t){if(""==t.name||isNaN(t.wins))throw console.log(t),new Error("正しく入力してください")},t.prototype.add=function(t){if(!(this.data.length<9))throw new Error("登録できるのは9人までです");this.data.push(t),f.textContent=""},t.prototype.save=function(){localStorage.setItem("player_data",JSON.stringify(this.data))},t.prototype.load=function(){var t=JSON.parse(localStorage.getItem("player_data"));this.data=t||[]},t.prototype.getHtml=function(){for(var t="<thead><th>投手名</th><th>勝利数</th></thead><tbody>",e=0,o=this.data;e<o.length;e++){var a=o[e];t+="<tr><td>"+a.name+"</td><td>"+a.wins.toLocaleString()+"</td></tr>"}return t+"</tbody><tr><td>合計</td><td>"+this.getTotal()+"</td></tr>"},t.prototype.getTotal=function(){for(var t=0,e=0,o=this.data;e<o.length;e++)t+=o[e].wins;return t.toLocaleString()},t.prototype.createImg=function(){m.drawImage(s,0,0);for(var t=0;t<this.data.length;t++)e=this.data[t].name,o=this.data[t].wins.toLocaleString(),f=t,void 0,u=a.value,m.font="bold 65px 'M PLUS 1'",m.textAlign="center",m.fillStyle="#666666",m.textBaseline="bottom",m.strokeText(e,n+f%3*l,r+Math.floor(f/3)*i,d),m.fillText(e,n+f%3*l,r+Math.floor(f/3)*i,d),m.font="bold 80px 'M PLUS 1', sans-serif, #ff0000",m.fillStyle="#ff0000",m.strokeText(o,400+f%3*l,r+Math.floor(f/3)*i,c),m.fillText(o,400+f%3*l,r+Math.floor(f/3)*i,c),m.font="bold 50px 'M PLUS 1'",m.fillStyle="#666666",m.fillText("勝",500+f%3*l,r+Math.floor(f/3)*i,100),m.font="bold 40px 'M PLUS 1'",m.fillStyle="#000000",m.fillText(u,1030,95,300),m.fillText("の安仁屋算が公開",1375,95,800),m.beginPath(),m.moveTo(n+f%3*l-70,r+(Math.floor(f/3)*i+10)),m.lineTo(n+f%3*l+d+c+20,r+(Math.floor(f/3)*i+10)),m.stroke();var e,o,f,u,g;g=this.getTotal(),m.font="bold 160px 'M PLUS 1'",m.textAlign="center",m.fillStyle="#ff0000",m.fillText(g,900,830,300),m.fillText(g,900,830,300)},t}());window.addEventListener("load",(function(){t=document.querySelector("#table"),e=document.querySelector("#player"),o=document.querySelector("#wins"),a=document.querySelector("#username"),g(S.getHtml()),document.querySelector("#btn").addEventListener("click",h),document.querySelector("#initial").addEventListener("click",p),document.querySelector("#create").addEventListener("click",y),document.getElementById("btn_dl").addEventListener("click",v),S.load(),g(S.getHtml())}))})();